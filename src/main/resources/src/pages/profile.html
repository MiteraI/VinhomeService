<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeLeaf.org" class="h-[100%] w-[100%]">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://kit.fontawesome.com/097aba0852.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../font.css" />
  <link rel="stylesheet" href="../dist/index.css" />
  <title>Service name goes here</title>
</head>

<body class="overflow-x-hidden h-[100%] w-[100%]">

  <header class="bg-blue-bootstrap lg:p-8 xl:p-8 md:p-8 sm:pb-0 sm:px-3 sm:pt-0 xm:pb-0 xm:px-3 xm:pt-0" id="Home">
    <nav class="navBar lg:mx-20 md:mx-20 sm:mx-0 xm:mx-0">
      <div
        class="lg:flex md:flex xl:flex xl:items-center lg:items-center md:items-center xl:justify-between lg:justify-between md:justify-between sm:hidden xm:hidden">
        <div>
          <a class="logo text-5xl font-extrabold text-white" href="/">SuperClean</a>
        </div>

        <div>
          <ul class="flex list-none space-x-20">
            <li class="text-xl font-medium text-white"><a href="/">Home</a></li>
            <li class="text-xl font-medium text-white"><a href="#about">About</a></li>
            <li class="text-xl font-medium text-white"><a href="#service">Service</a></li>
            <li class="text-xl font-medium text-white"><a href="#footer">Contact</a></li>
          </ul>
        </div>
        <!-- Profile links -->

        <div th:unless="${session.loginedUser}">
          <a href="/login"><button
              class="cursor-pointer rounded-xl border-none bg-white px-10 py-4 font-extrabold text-blue-bootstrap">
              Login
            </button></a>
        </div>

        <div th:if="${session.loginedUser}" class="profile-btn flex items-center justify-center flex-col w-44">
          <button id="dropdownDividerButton" data-dropdown-toggle="dropdownDivider"
            class="w-full h-inherit bg-white border-2 border-blue-700 hover:bg-gray-300 focus:outline-0 focus:ring-0 font-medium rounded-lg text-sm px-2 py-2 text-center inline-flex items-center justify-between "
            type="button">
            <span class="w-[20%] border-2 rounded-full border-blue-bootstrap">
              <img src="../../static/assets/images/user.png" alt="user-pfp" class="via-blue-bootstrap">
            </span>
            <span
              class="username w-[70%] box-border px-2 mr-2 overflow-hidden text-blue-bootstrap font-bold text-[16px]"
              th:text="${session.loginedUser.accountName}"></span>
            <svg class="w-[10%] h-4" aria-hidden="true" fill="none" stroke="currentColor" viewbox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <div id="dropdownDivider" class="z-10 hidden divide-y divide-gray-100 rounded-lg shadow w-44">
            <ul class="absolute w-inherit rounded-lg border-2 border-blue-700 bg-white"
              aria-labelledby="dropdownDividerButton">
              <li class="relative">
                <a href="/profile"
                  class="block font-bold text-[16px] text-blue-bootstrap px-4 py-2 hover:bg-gray-300 rounded-t-lg"><i
                    class="fa fa-user mr-2"></i>Profile</a>
              </li>
              <li class="relative">
                <a href="/order-history"
                  class="block font-bold text-[16px] text-blue-bootstrap px-4 py-2 hover:bg-gray-300"><i
                    class="fa fa-history mr-2"></i>Order History</a>
              </li>
              <li class="relative">

                <a href="/logout"
                  class="block font-bold text-[16px] text-blue-bootstrap px-4 py-2 hover:bg-gray-300 rounded-b-lg "><i
                    class="fa fa-sign-out mr-2"></i>Log Out</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="lg:hidden xl:hidden md:hidden lg:h-[0px] xl:h-[0px] md:h-[0px] sm:block xm:block">
        <div class="flex justify-between px-3 py-4">
          <div>
            <a class="text-5xl font-extrabold text-white" href="./index.html">SuperClean</a>
          </div>
          <button class="bars-toggle text-[2rem] text-white"><i class="fa fa-bars"></i></button>
        </div>

        <ul class="list-none transition-all duration-300 ease-linear overflow-hidden links lg:h-0 md:h-0 xl:h-0">
          <li class="text-white"><a href="#" class="px-[1rem] py-[0.5rem] block"><i
                class="fa fa-user mr-2"></i>Profile</a></li>
          <li class="text-white"><a href="#" class="px-[1rem] py-[0.5rem] block"><i
                class="fa fa-history mr-2"></i>Orders
              History</a></li>
          <li class="text-white"><a href="#" class="px-[1rem] py-[0.5rem] block"><i
                class="fa fa-sign-out mr-2"></i>Logout</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <div class="bg-orange-500 mx-20 my-7 py-5 px-4 relative flex items-center">
    <span class="">Please verify this phone number: <span class="ml-1 font-semibold"
        th:text="${phone != null} ? ${phone.number} : ''">1234567890</span></span>
    <button class="absolute right-0 mr-4 py-2 px-5 bg-transparent border-2 border-black">Verify</button>
  </div>

  <div class="mt-7 border-2 border-black mb-7 xl:mx-20 lg:mx-20 md:mx-20 sm:mx-0 xm:mx-0">

    <div class="mx-10 my-8 h-[100%] flex">
      <div class="w-[40%] h-[100%]">
        <div class="">
          <div class="bg-blue-400 flex justify-center items-center py-[5%] rounded-lg">
            <div class=" w-[40%]"><img class="object-cover w-[200px] h-[200px] border-8 border-white rounded-full"
                src="../assets/images/Keanu-Reeves-5939c06.jpg" alt="" srcset="">
            </div>
          </div>
        </div>

        <div class="flex flex-col items-center">
          <button
            class="edit-btn mt-7 bg-blue-300 hover:bg-blue-400 w-[50%] py-[1%] rounded-lg text-xl font-medium">Edit
            Profile</button>
          <button class="mt-7 bg-blue-300 hover:bg-blue-400 w-[50%] py-[1%] rounded-lg text-xl font-medium"><a
              class="text-decoration-none text-black w-[100%]" href="/resetpwd" target="_blank">Reset
              Password</a></button>
          <button
            class="change-pfp-btn mt-7 bg-blue-300 hover:bg-blue-400 w-[50%] py-[1%] rounded-lg text-xl font-medium">Change
            Profile
            Picture</button>
          <div class="upload-btn-container hidden w-[50%] mt-7 flex flex-col items-center">
            <span class="w-[100%] flex justify-center">
              <label for="upload-file"
                class="browse-pfp-btn w-[50%] bg-slate-300 hover:bg-slate-400 rounded-lg text-xl font-medium py-[1%] flex-1 text-center mr-[1%] flex justify-center">
                <span class="flex justify-center items-center"><i class="fa fa-upload mr-[5%]"
                    aria-hidden="true"></i>Browse</span>
              </label>
              <input type="file" class="hidden" value="" id="upload-file">
              <button
                class="upload-pfp-btn w-[50%] bg-green-300 hover:bg-green-400 py-[1%] px-[2%] rounded-lg text-xl font-medium flex-1 ml-[1%]">Upload</button>
            </span>
            <button
              class="cancel-pfp-btn mt-7 bg-red-300 hover:bg-red-400 w-[50%] py-[1%] rounded-lg text-xl font-medium">Cancel
            </button>
          </div>

          <div class="mt-7">
            <p class="img-file-name hidden"></p>
          </div>

        </div>
      </div>

      <div class="edit-form-container w-[60%] pl-[2%] pointer-events-none">
        <form class="edit-profile-form">
          <label for="">Username<span
              class="error-message italic text-red-500 ml-1 hidden text-[13px]"></span></label><br>
          <input type="text" name="txtUsername" value="" th:placeholder="${acc != null} ? ${acc.accountName}"
            class="profile-form-input w-[100%] border-2 rounded-lg bg-slate-200 px-3 py-2 mb-3 focus:outline-0">

          <label for="">Email<span class="error-message italic text-red-500 ml-1 hidden text-[13px]"></span></label><br>
          <input type="text" name="txtEmail" value="" th:placeholder="${acc != null} ? ${acc.email}"
            class="profile-form-input w-[100%] border-2 rounded-lg bg-slate-200 px-3 py-2 mb-3 focus:outline-0">

          <label for="">First Name</label><br>
          <span class="mb-3 flex">
            <input type="text" th:placeholder="${acc != null} ? ${acc.firstName}"
              class="prohibit-input w-[100%] border-2 rounded-l-lg bg-slate-200 px-3 py-2 pointer-event-none focus:outline-0 capitalize">
            <i class="fa fa-lock flex items-center border-2 rounded-r-lg bg-slate-200 pr-3"
              title="you can't edit this field"></i></span>

          <label for="">Last Name</label><br>
          <span class="mb-3 flex">
            <input type="text" th:placeholder="${acc != null} ? ${acc.lastName}"
              class="prohibit-input w-[100%] border-2 rounded-l-lg bg-slate-200 px-3 py-2 pointer-event-none focus:outline-0 capitalize">
            <i class="fa fa-lock flex items-center border-2 rounded-r-lg bg-slate-200 pr-3"
              title="you can't edit this field"></i></span>

          <label for="">Date of Birth<span
              class="error-message italic text-red-500 ml-1 hidden text-[13px]"></span></label><br>
          <input type="text" name="txtDate" value="" th:placeholder="${acc != null} ? ${acc.dob}"
            class="profile-form-input w-[100%] border-2 rounded-lg bg-slate-200 px-3 py-2 mb-3 focus:outline-0">

          <label for="">Phone<span class="error-message italic text-red-500 ml-1 hidden text-[13px]"></span></label><br>
          <div class="mb-3 w-[100%]">
            <span class="flex">
              <input type="text" name="txtPhone" value="" th:placeholder="${phone != null} ? ${phone[0].number}"
                class="profile-form-input w-[100%] border-2 rounded-l-lg bg-slate-200 px-3 py-2 focus:outline-0">
              <input type="hidden" name="txtPhoneId" th:value="${phone != null} ? ${phone[0].phoneId}">
              <i
                class="phoneDropDownButton fa fa-angle-down flex items-center border-2 rounded-r-lg bg-slate-200 pr-3 cursor-pointer"></i>
            </span>

            <div id="phoneDropdownContainer"
              class="z-10 divide-y hidden divide-gray-100 rounded-lg shadow w-inherit relative mt-[-1.3%]">
              <ul class="absolute w-inherit h-[7.5rem] border-2 bg-transparent overflow-y-scroll"
                aria-labelledby="dropdownDividerButton">
                <li class="relative">
                  <span class="block text-black px-3 py-1 hover:bg-gray-300 cursor-pointer">1234567890</span>
                </li>
              </ul>
            </div>
          </div>

          <div class="mb-3 w-[100%] flex items-center">
            <div class="w-[100%]">
              <label for="">Room</label><br>
              <span class="mb-3 flex">
                <input type="text" th:placeholder="${address != null} ? ${address.buildingRoom}"
                  class="prohibit-input w-[100%] border-2 rounded-l-lg bg-slate-200 px-3 py-2 focus:outline-0">
                <i class="fa fa-lock flex items-center border-2 rounded-r-lg bg-slate-200 pr-3"
                  title="you can't edit this field"></i></span>
            </div>

            <div class="ml-[6%] w-inherit">
              <label>Block</label><br>
              <div class="flex">
                <span class="prohibit-input-radio py-2 flex flex-[.5]">
                  <input class="scale-[1.3]" type="radio" value="A" th:checked="${address.buildingBlock} == A">
                  <input type="hidden" class="uid" th:value="${acc != null} ? ${acc.accountId}">
                  <span class="ml-[3%]">
                    Block A</span>
                </span>
                <span class="prohibit-input-radio py-2 flex flex-[.5]">
                  <input class="scale-[1.3]" type="radio" value="B" th:checked="${address.buildingBlock} == B">
                  <span class="ml-[3%]">
                    Block B</span>
                </span>
                <span class="prohibit-input-radio py-2 flex flex-[.5]">
                  <input class="scale-[1.3]" type="radio" value="C" th:checked="${address.buildingBlock} == C">
                  <span class="ml-[3%]">
                    Block C</span>
                </span>
              </div>
            </div>
          </div>
          <div class="flex justify-end ">
            <button class="cancel-btn px-3 py-2 bg-red-400 mr-[2%] rounded-lg hover:bg-red-500">Cancel</button>
            <button type="submit"
              class="submit-btn px-3 py-2 bg-blue-400 mr-[2%] rounded-lg hover:bg-blue-500">Save</button>
          </div>
        </form>

      </div>

    </div>



  </div>


  <script>
    const editFormContainer = document.querySelector('.edit-form-container')
    const editBtn = document.querySelector('.edit-btn')
    const errorMassage = document.querySelectorAll('.error-message')

    const profileForm = document.querySelector('.edit-profile-form');
    const profileFormInput = document.querySelectorAll('.profile-form-input');
    const prohibitInput = document.querySelectorAll('.prohibit-input')
    const prohibitInputRadio = document.querySelectorAll('.prohibit-input-radio')
    const profileBtn = document.querySelector('.profile-btn')
    const phoneDropDownButton = document.querySelector('.phoneDropDownButton')
    const phoneDropdownContainer = document.querySelector('#phoneDropdownContainer')
    const pfp = document.querySelectorAll('.pfp')
    const placeholderValue = [...profileFormInput].map(input => input.placeholder)

    const cancelBtn = document.querySelector('.cancel-btn')
    const changePfpBtn = document.querySelector('.change-pfp-btn')
    const cancelPfpBtn = document.querySelector('.cancel-pfp-btn')

    const dropDownMenuBtn = document.querySelector('#dropdownDividerButton')
    const dropDownMenu = document.querySelector('#dropdownDivider')

    const logo = document.querySelector('.logo');
    const logoStyle = window.getComputedStyle(logo, null).getPropertyValue('font-size');
    const logoFontSize = parseFloat(logoStyle);

    const uid = document.querySelector('.uid').value;
    const userName = document.querySelector('.username')
    const uploadFile = document.getElementById('upload-file')
    const uploadPfpBtn = document.querySelector('.upload-pfp-btn')
    const uploadBtnContainer = document.querySelector('.upload-btn-container')

    const imgFileName = document.querySelector('.img-file-name')

    const submitBtn = document.querySelector('.submit-btn');

    var _validFileExtensions = [".jpg", ".jpeg", ".png"];

    let canEdit = false
    let i = 0

    profileBtn.style.height = `${logoFontSize}px`

    cancelBtn.addEventListener('click', (e) => {
      e.preventDefault()

      errorMassage.forEach(err => {
        err.classList.add('hidden')
      })

      profileFormInput.forEach(input => {
        input.value = ''
        input.placeholder = placeholderValue[i]
        i++
      });
      i = 0;
      profileFormInput[2].type = 'text'
      editFormContainer.classList.add('pointer-events-none')
    })

    editBtn.addEventListener('click', (e) => {
      canEdit = true
      errorMassage.forEach(err => {
        err.classList.add('hidden')
      })
      editFormContainer.classList.remove('pointer-events-none')
      profileFormInput.forEach(input => {
        input.value = placeholderValue[i]
        input.placeholder = ''
        i++
      });
      i = 0
      profileFormInput[2].type = 'date'
    })

    profileFormInput.forEach(input => {
      input.addEventListener('keydown', (e) => {
        if (canEdit === false) {
          e.preventDefault()
        }

        e.returnValue = true
        for (let i = 0; i < prohibitInput.length; i++) {
          prohibitInput[i].value = ''
        }
      })
    })

    prohibitInput.forEach(input => {
      input.addEventListener('keydown', (e) => {
        if (e.keyCode === 9) {
          e.returnValue = true
        } else {
          e.preventDefault()
        }
      })
    })

    prohibitInputRadio.forEach(radio => {
      radio.addEventListener('click', (e) => {
        e.preventDefault()
      })
    })

    phoneDropDownButton.addEventListener('click', (e) => {
      phoneDropdownContainer.classList.toggle('hidden')
    })

    dropDownMenuBtn.addEventListener('click', () => {
      console.log("clicked")
      dropDownMenu.classList.toggle("hidden")
    })

    function hideDropDown() {
      document.onclick = () => {
        phoneDropdownContainer.classList.add('hidden')
        dropDownMenu.classList.add('hidden')
      }
    }

    changePfpBtn.addEventListener('click', () => {
      uploadBtnContainer.classList.toggle('hidden')
      changePfpBtn.classList.toggle('hidden')
    })

    cancelPfpBtn.addEventListener('click', () => {
      uploadFile.value = ''
      uploadFile.files.length = 0
      imgFileName.innerHTML = ''
      imgFileName.classList.add('hidden')
      console.log(uploadFile.files.length)
      console.log(uploadFile.value)
      uploadBtnContainer.classList.toggle('hidden')
      changePfpBtn.classList.toggle('hidden')
    })

    uploadPfpBtn.addEventListener('click', (e) => {
      if (checkFileExist() === false) {
        imgFileName.innerHTML = 'there is no image to upload'
        imgFileName.classList.add('italic', 'text-red-500')
        imgFileName.classList.remove('hidden')
        e.preventDefault()
      } else {
        e.returnValue = true
        console.log(uploadFile.value)
        console.log(uploadFile.files.length)
      }

    })

    const checkFileExist = () => {
      if (uploadFile.files.length == 0) {
        return false
      }
      return true
    }

    console.log(uid)

    // profileForm.addEventListener('submit', async (e) => {
    //   i = 0
    //   e.preventDefault()
    //   submitBtn.disabled = true
    //   const form_data = new FormData(profileForm);
    //   const data = Object.fromEntries(form_data);

    //   const response = await fetch(`/changeProfile/${uid}`,
    //     {
    //       method: "POST",
    //       headers: {
    //         'Content-Type': 'application/json'
    //       },
    //       body: JSON.stringify(data)
    //     });

    //   if (response.status == 400) {
    //     i = 0
    //     error_message = await response.json()
    //     error_message = Object.fromEntries(Object.entries(error_message).filter(([_, v]) => v != null));
    //     console.log(error_message);
    //     for (var key in error_message) {
    //       if (error_message[key]) {
    //         errorMassage[i].classList.remove('hidden')
    //         errorMassage[i].innerHTML = 'âŒ ' + error_message[key];
    //       }
    //       else {
    //         errorMassage[i].innerHTML = ''
    //       }
    //       console.log(`${i}: ${error_message[key]}`)
    //       i++;

    //     }
    //     i = 0
    //     submitBtn.disabled = false

    //   } else if (response.status == 200) {
    //     i = 0
    //     error_message = await response.json()
    //     error_message = Object.fromEntries(Object.entries(error_message).filter(([_, v]) => v != null));
    //     console.log(error_message)
    //     errorMassage.forEach(err => {
    //       err.classList.add('hidden')
    //     })
    //     for (var key in error_message) {
    //       console.log(placeholderValue[i])
    //       placeholderValue[i] = error_message[key]
    //       i += 1;
    //     }
    //     i = 0
    //     userName.innerHTML = placeholderValue[0]
    //     alert("successfully update profile")
    //     submitBtn.disabled = false

    //   } else if (response.status == 500) {
    //     error_message = await response.json()
    //     var list = document.getElementsByClassName("error-message");
    //     var i = 0;
    //     submitBtn.disabled = false
    //     alert("something wrong with server side, please try again later");
    //   }
    // })

    uploadFile.onchange = function ValidateSingleInput() {
      console.log();
      imgFileName.innerHTML = ''
      imgFileName.classList.remove('italic', 'text-red-500')
      var sFileName = uploadFile.value;
      console.log("sFileName:" + sFileName);
      if (sFileName.length > 0) {
        console.log("sFileName.length:" + sFileName.length);
        var blnValid = false;
        for (var j = 0; j < _validFileExtensions.length; j++) {
          var sCurExtension = _validFileExtensions[j];
          console.log("sCurExtension: " + sCurExtension);
          if (sFileName.substr(sFileName.length - sCurExtension.length, sCurExtension.length).toLowerCase() === sCurExtension.toLowerCase()) {
            imgFileName.innerHTML += `Image name: ${sFileName.split(/(\\|\/)/g).pop()}`
            imgFileName.classList.remove('hidden')
            blnValid = true;
            break;
          }
        }

        if (!blnValid) {
          imgFileName.innerHTML = ''
          imgFileName.classList.add('hidden')
          alert("Sorry, " + sFileName.split(/(\\|\/)/g).pop() + " is invalid, allowed extensions are: " + _validFileExtensions.join(", "));
          uploadFile.value = "";
          return false;
        }
      }
      var tgt = window.event.srcElement
      var file = tgt.files[0];
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.addEventListener("loadend", () => {
        pfp.forEach(p => {
          p.src = reader.result;
        })
      });
      return true;
    }

  </script>


</body>

</html>