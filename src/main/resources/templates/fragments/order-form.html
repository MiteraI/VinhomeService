<html lang="en" xmlns:th="http://thymeLeaf.org">

<head>
  <style>
    #order-form {
      /* Additional styling for position, background color, etc. */
      /* Position it on top of the current page */
      position: fixed;
      background-color: white;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50%;
      /* Other desired styles */
    }
  </style>
</head>

<body>
  <div>
    <form class="rounded-lg border-2 border-black" id="order-form" style="display: none">
      <div class="flex justify-center rounded-t-lg bg-yellow-info">
        <h1 class="px-8 py-4 font-bold text-xl">Order Service</h1>
      </div>
      <div class="p-8 space-y-2">
        <p>Service name: <span>House cleaning</span></p>
        <p>Price: <span>100$</span></p>
        <label for="timeSlot">Time Slot:</label>
        <div id="timeSlot"></div>
        <label for="payment">Payment:</label>
        <div id="payment"></div>
      </div>
      <div class="px-8 pb-8">
        <label for="date">Date: </label>
        <input class="border-2" type="date" id="date" name="day" />
      </div>
      <!-- add phone number -->
      <!-- add phone number -->
      <!-- add phone number -->
      <div class="form-group" style="margin-left: 20px; margin-bottom: 15px">
        <select name="phonenumber" id="phonenumber" size="1">

        </select>
        <!-- add phone number -->
        <!-- add phone number -->
        <!-- add phone number -->
        <!-- <label for="phonenumber">PhoneNumber</label>
      <input type="phonenumber" id="phonenumber" name="day"> -->
      </div>
      <br /><br />
      <div class="flex justify-center space-x-4">
        <button class="px-10 py-4 bg-blue-bootstrap text-white rounded-lg my-8" type="submit" id="submit-btn"
          onclick="">
          Submit
        </button>
        <button id="btnCancel" class="px-10 py-4 bg-red-cancel text-white rounded-lg my-8" onclick="">
          Cancel
        </button>
      </div>
    </form>
  </div>
  <script>
     const requestBody = {
        timeId: "",
        paymentId: "",
        day: "",
        serviceId: "",
        phonenumberId: ""
      };

    const orderForm = document.getElementById("order-form");
    orderForm.addEventListener("submit", (e) => {
      // Retrieve the selected radio button value
      e.preventDefault();
      const selectedTimeSlot = document.querySelector(
        'input[name="timeSlot"]:checked'
      ).value;
      const selectedPayment = document.querySelector(
        'select[name="payment"]'
      ).value;
      // Create the request body
      // const requestBody = {
      //   timeId: selectedTimeSlot,
      //   paymentId: selectedPayment,
      //   day: document.getElementById("date").value,
      //   serviceId: document.getElementById("serviceId").value,
      //   phonenumberId: ""
      // };
      requestBody.timeId = selectedTimeSlot
      requestBody.paymentId = selectedPayment
      requestBody.day = document.getElementById("date").value
      requestBody.serviceId = document.getElementById("serviceId").value
      requestBody.phonenumberId = 
      fetch("/vnpay/createPayment", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(requestBody),
      })
        .then((res) => {
          if (res.status === 200) {
            document.getElementById("order-form").style.display = "none";
            alert("You have ordered successfully");
          } else {
            console.log("Fail");
            alert("Fail in ordering");
          }
        })
        .catch((err) => {
          if (err.response.status === 401) {
            console.log("Exception");
          }
        });
    });

    const loadOrderForm = () => {
      const paymentDiv = document.getElementById("payment");
      const timeSlotDiv = document.getElementById("timeSlot");
      paymentDiv.innerHTML = "";
      timeSlotDiv.innerHTML = "";
      fetch("/api/order/timeSlot")
        .then((response) => response.json())
        .then((data) => {
          // Create radio buttons for each time slot
          data.forEach((timeSlot) => {
            const radioBtn = document.createElement("input");
            radioBtn.type = "radio";
            radioBtn.name = "timeSlot";
            radioBtn.value = timeSlot.timeSlotId;

            const label = document.createElement("label");
            label.textContent = `  ${timeSlot.startTime} - ${timeSlot.endTime}`;

            // Append radio button and label to the timeSlotDiv
            timeSlotDiv.appendChild(radioBtn);
            timeSlotDiv.appendChild(label);
            timeSlotDiv.appendChild(document.createElement("br"));
          });
        })
        .catch((error) => {
          console.log("Error fetching time slots:", error);
        });

      fetch("/api/order/payment")
        .then((response) => response.json())
        .then((data) => {
          const selectPayment = document.createElement("select");
          selectPayment.name = "payment";
          selectPayment.classList.add("border-2");

          // Create option elements for each payment option
          data.forEach((payment) => {
            const option = document.createElement("option");
            option.value = payment.paymentId;
            option.textContent = payment.paymentName;

            // Append each option to the select element
            selectPayment.appendChild(option);
          });

          // Append the select element to the paymentDiv
          paymentDiv.appendChild(selectPayment);
        })
        .catch((error) => {
          console.log("Error fetching payment options:", error);
        });
      // get all phone number for that particular customer
      // get all phone number for that particular customer
      // get all phone number for that particular customer
      fetch(`/createAccountAPI/getAllPhonenumber`, {
        method: "get"
      })
        .then(response => response.json())
        .then(data => {
          console.log(data)
          const phoneListTag = document.getElementById("phonenumber")
          output = "";
          for (var i in data) {
            var builder = `
            <option value="${data[i].phoneId}"> ${data[i].number}</option>`
                    
            output += builder;
          }
          phoneListTag.innerHTML = output;
          requestBody.phonenumberId = data[0].phoneId;
          phoneListTag.addEventListener('click', function (event) {
            console.log("yes it is clicked")
            console.log(this.value)
            requestBody.phonenumberId = this.value;
          })
        })



    };
    const orderBtn = document.getElementById("order-btn");
    orderBtn.addEventListener("click", () => {
      orderForm.style.display =
        orderForm.style.display === "none" ? "block" : "none";
    });
    document.addEventListener("click", (event) => {
      if (!orderForm.contains(event.target) && event.target !== orderBtn) {
        // Hide the form if the click is outside the form segment and not on the order button
        orderForm.style.display = "none";
      }
    });

    const cancelButton = document.getElementById("btnCancel");
        cancelButton.addEventListener("click", function (event) {
            event.preventDefault();
            const divForm = document.getElementById("order-form");
            divForm.style.display = 'none';
        })

  </script>
</body>

</html>