<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeLeaf.org">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
          crossorigin="anonymous"></script>
  <title>Title</title>
  <style>
    .hihi {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      z-index: 1000;
      display: none;
      border: black;
    }
  </style>
</head>
<body>
<header th:replace="~{./fragments/adminHeader.html}"></header>


<div class="container">
  <button type="button" class="btn btn-primary" id="showCreateCategory">Create Category</button>
  <table class="table table-striped">
    <thead>
    <tr>
      <th>ID</th>
      <th>Category Name
      <th>Action</th>
    </tr>
    </thead>
    <tbody id="tbody-categories">

    </tbody>
  </table>
</div>
<script>
  fetch("/api/categories")
          .then(res => res.json())
          .then(data => {
            let output = '';
            data.forEach(item => {
              const categoryId = item['serviceCategoryId'];
              const categoryName = item['serviceCategoryName'];
              output +=
                      `
                  <tr>
                    <td>${categoryId}</td>
                    <td>${categoryName}</td>
                    <td><a class="btn btn-primary" onclick="update('${categoryId}', '${categoryName}')">Update</a></td>
                  </tr>
               `
            })
            document.getElementById("tbody-categories").innerHTML = output;
          })
</script>

<!--FORM CREATE CATEGORY-->
<!--FORM CREATE CATEGORY-->
<!--FORM CREATE CATEGORY-->

<div class="hihi" id="createCategoryFormContainer" style="display: none;">
  <h3>Create Service</h3>
  <form id="createCategoryForm" style="border-color: black">
    <div class="form-group">
      <label for="categoryName">Category Name:</label>
      <input type="text" class="form-control" id="categoryName" required>
    </div>
    <div style="margin-top: 15px">
      <button type="button" class="btn btn-secondary" id="cancelCreateService">Cancel</button>
      <button type="submit" class="btn btn-primary">Create</button>
    </div>
  </form>
</div>
<!--FORM Update CATEGORY-->
<!--FORM Update CATEGORY-->
<!--FORM Update CATEGORY-->

<div class="hihi" id="updateCategoryFormContainer" style="display: none;">
  <h3>Update Service</h3>
  <form id="updateCategoryForm" style="border-color: black">
    <div class="form-group">
      <label for="categoryNameUpdate">Category Name:</label>
      <input type="text" class="form-control" id="categoryNameUpdate" required>
    </div>
    <div style="margin-top: 15px">
      <button type="button" class="btn btn-secondary" id="cancelUpdateCategory">Cancel</button>
      <button type="submit" class="btn btn-primary">Update</button>
    </div>
  </form>
</div>

<script>
  function update(categoryId, categoryName) {
    document.getElementById("updateCategoryFormContainer").style.display = "block";
    document.getElementById("categoryNameUpdate"). value = categoryName;
    var categoryNameUpdate = '';
    document.getElementById("categoryNameUpdate").addEventListener("input", function () {
      categoryNameUpdate = this.value;
    })
    document.getElementById("updateCategoryFormContainer").addEventListener("submit", function (e) {
      e.preventDefault();

      var formData = new FormData();
      formData.append("categoryName", categoryNameUpdate)
      fetch("/api/update-category/" + categoryId, {
        method: 'POST',
        body: formData
      })
              .then (res =>  {
                if (res.status === 201) {
                  window.location.reload();
                }
                else {

                }
              })
              .catch(err => {
                console.log(err);
              })
    })
    document.getElementById("cancelUpdateCategory").addEventListener("click", function () {
      document.getElementById("updateCategoryFormContainer").style.display = "none";
      categoryNameUpdate = '';
      categoryId = 0;
    })

  }
</script>


<script>
  document.getElementById("showCreateCategory").addEventListener("click", function () {
    document.getElementById("createCategoryFormContainer").style.display = "block";
  })
</script>
<script>
  document.getElementById("createCategoryForm").addEventListener("submit", function (evt) {
    evt.preventDefault();
    const categoryName = document.getElementById('categoryName').value;
    var formData = new FormData();
    formData.append("categoryName", categoryName);
    fetch("api/create-service-category", {
      method: 'POST',
      body: formData
    })
            .then(res => {
              if (res.status === 201) {
                alert("v");
              }
              else {
                alert("Not Successfully");
              }
            })
            .catch(err => {
              alert(err);
            })
  })

  document.getElementById("cancelCreateService").addEventListener("click", function () {
    document.getElementById("createCategoryFormContainer").style.display = "none";
  })

</script>
</body>
</html>