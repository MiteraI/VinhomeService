<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeLeaf.org">

<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title th:text="${acc != null} ? ${acc.accountName} + '\'s profile' : ''"></title>
    <meta content="no-cache, no-store, must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="Pragma">
    <meta content="0" http-equiv="Expires">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" rel="stylesheet"/>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <style>
        body {font-family: Arial, Helvetica, sans-serif;}
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${acc != null} ? ${acc.accountName} + '\'s profile' : ''"></title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="../static/bootstrap-5.0.2-dist/css/bootstrap.css">
  <style>
    .edit_btn:hover,
    .submit_btn:hover,
    .reset-pwd:hover {
      background-color: aqua;
    }

        /* The Modal (background) */
        .modal {
          display: none; /* Hidden by default */
          position: fixed; /* Stay in place */
          z-index: 1; /* Sit on top */
          padding-top: 100px; /* Location of the box */
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 100%; /* Full width */
          height: 100%; /* Full height */
          overflow: auto; /* Enable scroll if needed */
          background-color: rgb(0,0,0); /* Fallback color */
          background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
          position: relative;
          width: 60%; /* Set width size */
          background-color: #fefefe;
          margin: auto;
          padding: 0;
          width: 40%;
          height: 20%;
          border: 1px solid #888;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
          -webkit-animation-name: animatetop;
          -webkit-animation-duration: 0.4s;
          animation-name: animatetop;
          animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
          from {top:-300px; opacity:0}
          to {top:0; opacity:1}
        }

        @keyframes animatetop {
          from {top:-300px; opacity:0}
          to {top:0; opacity:1}
        }

        /* The Close Button */
        .close {
          color: white;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
        }

        .modal-header {
          padding: 2px 16px;
          font-size: 20px;
          background-color: #3a3a3a;
          color: white;
        }

        .modal-body {
            padding: 2px 16px;
            color: #fffef7;
        }

        .modal-footer {
          padding-left: 10px;
          background-color: #636363;
          color: white;
        }
    </style>

</head>

<body class="min-vh-100 d-flex align-items-center justify-content-center">
<div class=" container w-75 border rounded">
    <div class="d-flex">
        <div class="me-3">
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <!--get account id-->
            <input id="accID" th:value="${acc != null} ? ${acc.accountId} : ''" type="hidden">
            <script>
            const accountID = document.getElementById("accID").value;
            axios
                .get("http://localhost:8080/images/getAvatar/avatar.png?time=" + new Date().getTime())
<!--                .get("http://2cedcd6c980412.lhr.life/images/getAvatar/avatar.png?time=" + new Date().getTime())-->  //FOR PUBLISH SERVER//
                .then((response) => {
                    console.log(response.data);
                    document.getElementById("avatar").src = response.data;
                })
                .catch((error) => {
                    console.log(error);
                });
            </script>
            <img alt="avatar" class="avatar" id="avatar" loading="lazy" src=""
                 style="height: 150px; width: 150px; object-fit: cover; object-position: 100% 0; border-radius: 50%; margin-bottom: 10px;">
            <script defer src="https://cdn.crop.guide/loader/l.js?c=TJTGWG"></script>
        </div>
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close">&times;</span>
                    <h2 id="modalHeader"></h2>
                </div>
                <div class="modal-body">
                    <p id="modalBody"></p>
                </div>
                <div class="modal-footer">
                    <p id="modalFooter"></p>
                </div>
            </div>
        </div>

        <form>
            <input accept="image/*" class="input-file" id="file" name="file" type="file"/>
            <input class="upload_btn float-end btn border-info mt-1 mb-1" id="uploadBtn" onclick="uploadAvatar()"
                   style="box-shadow: none;"
                   type="button" value="upload">
        </form>
    </div>
    <form class="profile_form">
        <table class="table table-bordered mb-0">
            <tr>
                <td class="text-end pe-4">Username</td>
                <td class="td_data"><span class="span_data ms-2"
                                          th:text="${acc != null} ? ${acc.accountName} : ''"></span>
                </td>
            </tr>

            <tr>
                <td class="text text-end pe-4">Password</td>
                <td class="td_data"><span class="span_data txt_pwd ms-2 w-100"
                                          th:text="${acc != null} ? ${acc.password} : ''"></span>
                </td>
            </tr>

            <tr>
                <td class="text-end pe-4">First Name</td>
                <td class="td_data"><span class="span_data ms-2"
                                          th:text="${acc != null} ? ${acc.firstName} : ''"></span>
                </td>
            </tr>

            <tr>
                <td class="text-end pe-4">Last Name</td>
                <td class="td_data"><span class="span_data ms-2" th:text="${acc != null} ? ${acc.lastName} : ''"></span>
                </td>
            </tr>

            <tr>
                <td class="text-end pe-4">Date of birth</td>
                <td class="td_data"><span class="span_data ms-2" th:text="${acc != null} ? ${acc.dob} : ''"></span></td>
            </tr>

            <tr>
                <td class="text-end pe-4">Email</td>
                <td class="td_data"><span class="span_data ms-2" th:text="${acc != null} ? ${acc.email} : ''"></span>
                </td>
            </tr>


        </table>
        <input class="cancel_btn float-end d-none btn border-danger ms-1 mt-1 mb-1" style="box-shadow: none"
               type="button"
               value="cancel">
        <input class="edit_btn float-end btn border-info mt-1 mb-1" style="box-shadow: none;" type="button"
               value="edit">
        <a class="btn btn-primary float-start mt-1 mb-1" href="/homepage" style="box-shadow: none;">Back to homepage</a>
    </form>
</div>

<script>
  const txtPassword = document.querySelector('.txt_pwd');
  const profileForm = document.querySelector('.profile_form');
  const tdData = document.querySelectorAll('.td_data');
  const spanData = document.querySelectorAll('.span_data');
  const editBtn = document.querySelector('.edit_btn');
  const cancelBtn = document.querySelector('.cancel_btn');
  let arrData = [...spanData].map(data => data.textContent);
  let spanClassArr = ["d-flex", "align-items-center", "justify-content-center"]
  let p = txtPassword.textContent;
  let hidden = "";
  let tmp = ""

  for (let i = 0; i < txtPassword.textContent.length; i++) {
    hidden += "●";
  }
  tmp = hidden
  txtPassword.textContent = hidden;
  console.log(tmp);

  cancelBtn.addEventListener('click', (e) => {
    e.preventDefault();
    hidden = "";
    for (let i = 0; i < tdData.length; i++) {
      if (i == 1) {
        spanData[i].classList.remove(...spanClassArr)
        p = arrData[i];
        const inputPassword = document.querySelector('.input_pwd');
        for (let i = 0; i < inputPassword.value.length; i++) {
          hidden += "●";
        }
        txtPassword.textContent = hidden;
        tmp = hidden;
        spanData[i].classList.add('ms-2')
        spanData[i].innerHTML = `${txtPassword.textContent}`
      }
      else {
        spanData[i].classList.add('ms-2')
        spanData[i].innerHTML = `${arrData[i]} `
      }
    }
    cancelBtn.classList.remove('d-block')
    cancelBtn.classList.add('d-none')
    editBtn.value = 'edit'
  })

  editBtn.addEventListener('click', (e) => {
    e.preventDefault()
    cancelBtn.classList.remove('d-none')
    cancelBtn.classList.add('d-block')
    editBtn.value = 'submit'
    for (let i = 0; i < spanData.length; i++) {
      if (i == 1) {
        spanData[i].classList.remove('ms-2')
        spanData[i].classList.add(...spanClassArr)
        spanData[i].innerHTML = `<input class="input_data input_pwd w-100" type="text" value="${hidden}" /><button type="button" class="border-start-0 bg-transparent"><i class="fa fa-eye-slash"></i></button>`
        const inputPassword = document.querySelector('.input_pwd');
        const eyeSlash = document.querySelector('.fa-eye-slash');
        eyeSlash.addEventListener('click', () => {
          eyeSlash.classList.toggle('fa-eye-slash');
          eyeSlash.classList.toggle('fa-eye');
          inputPassword.value = p;
          p = tmp;
          tmp = inputPassword.value;
        })
      }
      else {
        spanData[i].classList.remove('ms-2')
        spanData[i].innerHTML = `<input class="input_data w-100" type="text" value="${arrData[i]}" />`
      }
    }
    editBtn.addEventListener('submit', (e) => {
      console.log("click");
    })
  })

function uploadAvatar() {
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close")[0];
    var modalBody = document.getElementById("modalBody");
    var modalHeader = document.getElementById("modalHeader");
    var modalFooter = document.getElementById("modalFooter");

    var fileInput = document.getElementById('file');
    var filename = fileInput.files[0].name;
    //UPLOAD BUT MULTIPART//
    var formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('filename', filename);
    var id = document.getElementById('accID').value;
    axios.post('http://localhost:8080/images/avatar', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      }
    }).then(function (response) {
      console.log(response);
      if (response.status == 200) {
        modal.style.display = "block";
        modalHeader.innerHTML = "Success!";
        modalBody.innerHTML = "Upload avatar successfully!";
        modalBody.style.color = "green";
        modalFooter.innerHTML = "Note: It may take from 30 secs to 1 min to update your avatar. Clear your browser cache if you don't see the change.";
      }
    }).catch(function (error) {
          console.log(error);
            modal.style.display = "block";
            modalHeader.innerHTML = "Failed!";
            modalBody.innerHTML = "Upload avatar failed!";
            modalBody.style.color = "red";
        });

                // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
          location.reload(true);
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
            location.reload(true);
          }
        }
    }

</script>
=======
<div class="container card border-danger" style="border-radius: 1%; border: 1px solid red;">
  <div class="card-body">
    <form class="profile_form">
      <div class="row">
        <div class="mt-1 mb-1 p-0 d-flex flex-column" style="height: 200px; width: 200px; margin-left: 1%;"><img
                src="../static/img/user.png" alt="" class="border border-dark"
                style="padding: 2px; object-fit: cover; margin-bottom: 5px; height: 80%; width: 80%;">
          <input type="button" class="btn-info" value="Change Profile Picture" style="width: 80%; font-size: 15px;">

        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Username</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span th:text="${acc != null} ? ${acc.accountName} : ''" class="span_data"></span>
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(0)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>

      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Email</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span th:text="${acc != null} ? ${acc.email} : ''" class="span_data"></span>
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(1)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">First Name</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span th:text="${acc != null} ? ${acc.firstName} : ''" class="span_data"></span>
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(2)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Last Name</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span th:text="${acc != null} ? ${acc.lastName} : ''" class="span_data"></span>
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(3)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Date of birth</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span th:text="${acc != null} ? ${acc.dob} : ''" class="span_data"></span>
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(4)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Address</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
            <span class="">
              <div class="form-group d-flex">
                <label class="me-2">Room: </label>
                <div th:text="${address != null} ? ${address.buildingRoom} : ''" class="me-3 span_data">
                </div>
                <label class="me-2">Block:</label>
                <div th:text="${address != null} ? ${address.buildingBlock} : ''" class="span_data"></div>
                <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                        title="click to edit" onclick="editBtnClicked(5)"><i class="fas fa-pen"></i></button>
              </div>
            </span>

        </div>
      </div>
      <hr>
      <div class="row">
        <div class="error-message fst-italic text-danger d-none" style="margin-left: 25%;font-size: 13px;">fvdavdvasds
        </div>
        <div class="col-sm-3">
          <h6 class="mb-0">Phone</h6>
        </div>
        <div class="div_data col-sm-9 text-secondary">
          <span class="span_data" th:text="${phone != null} ? ${phone[0].number} : ''"></span>
          <input type="hidden" name="txtPhoneId" class="d-none" th:value="${phone != null} ? ${phone[0].phoneId} : ''">
          <button class="edit_btn border-0 bg-transparent position-absolute" style="right: 2%" type="button"
                  title="click to edit" onclick="editBtnClicked(6)"><i class="fas fa-pen"></i></button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-sm-12">
          <input type="hidden" name="uid" class="id" th:value="${acc != null} ? ${acc.accountId} : ''">

          <input type="submit" class="submit_btn btn border-info mt-1 mb-1" style="box-shadow: none;" value="Save">
          <button class="reset-pwd btn border-info mt-1 mb-1" type="button" title="click to edit"><a href="/resetpwd"
                                                                                                     class="text-black text-decoration-none" target="_blank">
            Reset Password</a></button>

        </div>
      </div>
    </form>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="../static/js/editProfile.js"></script>
</body>

</html>